<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Share Your Story</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800;900&family=Baloo+2:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --muted:#e7edf5;
      --text:#205b7a; --sub:#3d738d; --accent:#4fb3ff; --border:#0a2c45;
      --ok:#2fbf71; --bad:#e15757;
    }
    *, *::before, *::after{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Baloo 2', Inter, system-ui, Arial;color:var(--text);
      /* Add a soft overlay to keep text readable on all screens */
      background-image: linear-gradient(rgba(244,247,251,0.92), rgba(244,247,251,0.92)), url('105.jpg');
      background-size:cover;background-position:center;background-repeat:no-repeat;
    }
    .wrap{max-width:980px;margin:0 auto;padding:clamp(12px,3vw,24px)}
    header{display:flex;align-items:center;justify-content:flex-start;margin:8px 0 16px}
    .title{font-weight:900;letter-spacing:-0.02em;font-size:clamp(22px,4vw,34px)}
    .sub{color:var(--sub);font-weight:700;font-size:clamp(13px,2.2vw,16px)}
    .card{background:linear-gradient(180deg,#ffffff,#f6fbff);border:1px solid var(--border);border-radius:16px;padding:clamp(16px,3vw,24px);box-shadow:0 30px 100px rgba(23,43,77,.08);}
    .row{display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
    label{font-weight:800;font-size:clamp(14px,2vw,16px)}
    textarea,input{width:100%;background:#ffffff;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:12px;font-size:clamp(14px,2.2vw,16px)}
    textarea{min-height:clamp(160px,30vh,260px)}
    .note{font-size:clamp(12px,1.8vw,13px);color:var(--sub)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:none;border-radius:10px;padding:12px 16px;font-weight:800;color:#ffffff;background:var(--accent);cursor:pointer;font-size:clamp(14px,2.4vw,16px)}
    .btn.secondary{background:var(--muted);color:var(--text);border:1px solid var(--border)}
    .result{white-space:pre-wrap;background:#ffffff;border:1px dashed var(--border);padding:12px;border-radius:10px;font-size:clamp(14px,2.2vw,16px)}
    .disabled{opacity:.6;pointer-events:none}

    /* Small screens: stack actions, full-width buttons */
    @media (max-width: 480px){
      .actions{flex-direction:column}
      .btn{width:100%}
      .card{border-radius:12px}
    }

    /* Medium screens: comfortable reading width */
    @media (min-width: 768px){
      .wrap{max-width:860px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Share A Story</div>
        <div class="sub">Tell one story at a time — thanks!</div>
      </div>
    </header>

    <div class="card">
      <div class="row">
        <label for="story">Tell a funny story about your life… (the funnier the better)</label>
        <textarea id="story" placeholder="Tell a funny story about your life..."></textarea>
      </div>
      <div class="row">
        <label for="name">Submit your name…</label>
        <input id="name" type="text" placeholder="Submit your name..." />
      </div>
      <div class="note">All answers will be run through AI in order to remove possible identifying information.</div>
      <div class="actions" style="margin-top:12px">
        <button id="submitBtn" class="btn">Submit</button>
      </div>
    </div>

    <div class="card" style="margin-top:16px;display:none" id="resultCard">
      <div style="font-weight:900;margin-bottom:8px">Sanitized Story</div>
      <div id="result" class="result"></div>
      <div class="note" style="margin-top:8px">This AI-style sanitizer tries to remove identifying details, tidy grammar, and sprinkle in light dad humor without changing the core story.</div>
    </div>
  </div>

  <script>
    // Simple AI-style sanitizer (client-side, rule-based)
    function anonymizePII(text, name){
      let out = text || '';
      // Emails
      out = out.replace(/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/gi, '[redacted email]');
      // Phone numbers
      out = out.replace(/(?:\+?\d{1,3}[\s-]?)?(?:\(?\d{3}\)?[\s-]?)\d{3}[\s-]?\d{4}/g, '[redacted phone]');
      // Street addresses
      out = out.replace(/\b\d{1,5}\s+(?:[A-Za-z]+\s)+(?:St|Street|Ave|Avenue|Rd|Road|Blvd|Boulevard|Lane|Ln|Dr|Drive|Court|Ct)\b/gi, '[redacted address]');
      // Dates (Month Day, Year or short formats)
      out = out.replace(/\b(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|Jun(?:e)?|Jul(?:y)?|Aug(?:ust)?|Sep(?:t(?:ember)?)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)\s+\d{1,2}(?:,\s*\d{4})?\b/gi, '[on a certain day]');
      out = out.replace(/\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/g, '[on a certain day]');
      // Social handles
      out = out.replace(/@[A-Za-z0-9_]+/g, '[handle]');
      // Names (provided)
      if(name && name.trim()){
        const escaped = name.trim().replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        out = out.replace(new RegExp('\\b' + escaped + '\\b', 'gi'), '[someone]');
      }
      // Locations (very naive: "at/in ProperNoun")
      out = out.replace(/\b(?:at|in)\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)?\b/g, '[somewhere]');
      return out;
    }

    function censorSwears(text){
      const words = ['fuck','shit','bitch','asshole','bastard','dick','piss','cunt','bollocks','wanker'];
      const re = new RegExp('\\b(' + words.join('|') + ')\\b', 'gi');
      return (text||'').replace(re, (m)=> m[0] + '***');
    }

    function neutralizePronouns(text){
      const pronouns = [
        'he','she','they','him','her','them','his','hers','theirs',
        'i','me','my','mine','myself','we','us','our','ours','ourselves',
        'boy','girl','man','woman','male','female'
      ];
      const re = new RegExp('\\b(' + pronouns.join('|') + ')\\b', 'gi');
      return (text||'').replace(re, 'he/she');
    }

    function grammarPolish(text){
      let t = (text || '').replace(/\s+/g, ' ').trim();
      t = t
        .replace(/\bi'm\b/gi, "I'm")
        .replace(/\bim\b/gi, "I'm")
        .replace(/\bgonna\b/gi, 'going to')
        .replace(/\bkinda\b/gi, 'kind of')
        .replace(/\bsorta\b/gi, 'sort of')
        .replace(/\bcuz\b/gi, 'because')
        .replace(/\bcoz\b/gi, 'because')
        .replace(/\btho\b/gi, 'though')
        .replace(/\bain't\b/gi, 'is not');
      if(!/[.!?]$/.test(t)) t += '.';
      t = t.replace(/(^|[.!?]\s+)([a-z])/g, (m, pre, c)=> pre + c.toUpperCase());
      return t;
    }

    function injectDadHumor(text){
      const jokes = [
        'I used to be addicted to the hokey pokey, but I turned myself around.',
        'I ordered a chicken and an egg from Amazon — I’ll let you know.',
        'I don’t trust stairs; they’re always up to something.'
      ];
      const joke = jokes[Math.floor(Math.random()*jokes.length)];
      return text + '\n\n(PS: ' + joke + ')';
    }

    async function remoteModel(text){
      // Optional: call a remote AI sanitizer if available.
      // Replace the URL with your endpoint; this is a stub that falls back locally.
      const endpoint = new URLSearchParams(location.search).get('modelEndpoint');
      if(!endpoint) return null;
      try{
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        if(!res.ok) return null;
        const data = await res.json();
        return (data && (data.text || data.result)) || null;
      }catch(e){ return null; }
    }

    async function sanitizeStory(story, name){
      // Try remote model first if provided, else use local rule-based pipeline.
      const remote = await remoteModel(story);
      if(remote) return remote;
      const filtered = neutralizePronouns(censorSwears(story));
      const anon = anonymizePII(filtered, name);
      const polished = grammarPolish(anon);
      const withHumor = injectDadHumor(polished);
      return withHumor;
    }

    const submitBtn = document.getElementById('submitBtn');
    const storyEl = document.getElementById('story');
    const nameEl = document.getElementById('name');
    const resultCard = document.getElementById('resultCard');
    const resultEl = document.getElementById('result');

    // No per-person lock: allow repeated submissions

    submitBtn.addEventListener('click', async ()=>{
      if(submitBtn.classList.contains('disabled')) return;
      const story = storyEl.value.trim();
      const name = nameEl.value.trim();
      if(!story){ alert('Please enter your story.'); return; }
      if(!name){ alert('Please enter your name.'); return; }
      submitBtn.textContent = 'Processing…'; submitBtn.classList.add('disabled');
      const sanitized = await sanitizeStory(story, name);
      // Append to local aggregated text store (to be exported later)
      const line = `Q||${sanitized}\n`;
      try{
        const prev = localStorage.getItem('twSubmissionsText') || '';
        localStorage.setItem('twSubmissionsText', prev + line);
      }catch(e){}
      alert('Your story has been submitted.');
      location.reload();
    });
  </script>
</body>
</html>
